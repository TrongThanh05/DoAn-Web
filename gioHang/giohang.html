<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gi·ªè H√†ng</title>
    <!-- link css -->
    <link rel="stylesheet" href="../css/basic.css" />
    <link rel="stylesheet" href="../css/header.css" />
    <link rel="stylesheet" href="../css/footer.css" />
    <link rel="stylesheet" href="../css/giohang.css" />
    <!-- reset css -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
    />
    <!-- get icon with cdn fontawesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
  </head>
  <body>
    <header class="header">
      <!-- menu khi m√†n h√¨nh thu nh·ªè t·ªõi 1 m·ª©c nh·∫•t ƒë·ªãnh c√≥ @media ·ªü d∆∞·ªõi c√πng  -->
      <ul class="header__menuMobile" id="header__menuMobile">
        <div class="header__menuMobile-title">
          <p>üõí Menu</p>
          <i id="exitMenu" class="fa-solid fa-xmark"></i>
        </div>
        <li><a href="../tranhchu/trangchu.html">Trang ch·ªß</a></li>
        <li class="header__menu-dropdown">
          <a href="../sanPham/sanpham.html">S·∫£n Ph·∫©m</a>
          <div class="dropdown-list">
            <a href="../html/ao.html">√Åo</a>
            <a href="../html/quan.html">Qu·∫ßn</a>
            <a href="../html/giay.html">Gi√†y</a>
          </div>
        </li>
        <li><a href="../gioThieu/gioithieu.html">Gi·ªõi Thi·ªáu</a></li>
        <li><a href="../lienHe/lienhe.html">Li√™n H·ªá</a></li>
      </ul>
      <nav>
        <div class="header__bar">
          <i id="barIcon" class="fa-solid fa-bars"></i>
        </div>
        <!-- logo -->
        <a href="../tranhchu/trangchu.html" class="header__logo">
          <img src="../img/backGround&vv/logo_shop.png" alt="Logo" />
        </a>
        <!-- Menu -->
        <ul class="header__menu">
          <li><a href="../tranhchu/trangchu.html">Trang ch·ªß</a></li>
          <li class="header__menu-dropdown">
            <a href="../sanPham/sanpham.html">S·∫£n Ph·∫©m</a>
            <div class="dropdown-list">
              <a href="../html/ao.html">√Åo</a>
              <a href="../html/quan.html">Qu·∫ßn</a>
              <a href="../html/giay.html">Gi√†y</a>
            </div>
          </li>
          <li><a href="../gioThieu/gioithieu.html">Gi·ªõi Thi·ªáu</a></li>
          <li><a href="../lienHe/lienhe.html">Li√™n H·ªá</a></li>
        </ul>
        <div class="header__icon">
          <div class="header__icon--noti">
            <i class="notiIcon fa-solid fa-bell"></i>
            <span id="noti-badge" class="noti-badge">0</span>
            <div class="header__icon--notiList">
              <div class="notificationTitle">
                <h4>Th√¥ng b√°o m·ªõi nh·∫≠n</h4>
                <button id="deleteAllNoti">X√≥a h·∫øt th√¥ng b√°o</button>
              </div>
              <div class="allNotification"></div>
              <button id="showAllNotice">Xem t·∫•t c·∫£</button>
            </div>
          </div>
          <!-- Gi·ªè h√†ng -->
          <div class="header__icon--cart">
            <a href="../gioHang/giohang.html">
              <i class="fas fa-shopping-cart"></i>
            </a>
            <span id="cart-badge" class="cart-badge">0</span>
          </div>
          <!-- s·∫£n ph·∫©m ƒë√£ th√≠ch -->
          <div class="header__icon--heart">
            <a href="../sanPhamYeuThich/sanpham_yeuthich.html"
              ><i class="fa-solid fa-heart"></i
            ></a>
            <span id="heart-badge" class="heart-badge">0</span>
          </div>
          <!-- Ng∆∞·ªùi d√πng -->
          <div class="header__icon--user">
            <i class="fas fa-user"></i>
            <div class="user-dropdown">
              <a href="../dangNhap&dangKy/dangnhap_dangky.html?type=login"
                >ƒêƒÉng nh·∫≠p</a
              >
              <a href="../dangNhap&dangKy/dangnhap_dangky.html?type=register"
                >ƒêƒÉng k√Ω</a
              >
            </div>
          </div>
        </div>
      </nav>
      <div class="header__under">
        <a href="../tranhchu/trangchu.html">Trang ch·ªß</a>
        / √Åo
      </div>
    </header>

    <div class="main">
      <table>
        <thead>
          <tr>
            <th>Ch·ªçn</th>
            <th>T√™n S·∫£n Ph·∫©m</th>
            <th>ƒê∆°n Gi√°</th>
            <th>S·ªë L∆∞·ª£ng</th>
            <th>S·ªë Ti·ªÅn</th>
            <th>Thao T√°c</th>
          </tr>
        </thead>
        <tbody id="cartItems">
          <!-- C√°c item hi·ªán ·ªü ƒë√¢y qua js -->
        </tbody>
      </table>

      <div class="main__totalPrice">
        T·ªïng c·ªông: <span id="totalAmount">0</span> VNƒê
      </div>

      <button class="main__btnConfirm" id="confirmPayment">X√°c nh·∫≠n</button>
    </div>
    <footer class="footer">
      <div class="footer__contact">
        <div class="footer__contact-item">
          <div class="footer__contact-address">
            <i class="fa-solid fa-map"></i>ƒê·ªãa ch·ªâ : Tr∆∞·ªùng ƒê·∫°i h·ªçc Vinh, Th√†nh
            ph·ªë Vinh, Ngh·ªá An
          </div>
          <div class="footer__contact-phone">
            <i class="fa-solid fa-phone"></i>S·ªë ƒëi·ªán tho·∫°i : 0123456789
          </div>
          <div class="footer__contact-email">
            <i class="fa-solid fa-envelope"></i>
            Email :
            <a href="mailto:4bros@gmail.com">4bros@gmail.com</a>
          </div>
        </div>
        <div class="footer__contact-item">
          <h3>CH√çNH S√ÅCH</h3>
          <ul class="footer__contact-policy">
            <li><a href="../tranhchu/trangchu.html">Trang ch·ªß</a></li>
            <li><a href="../sanPham/sanpham.html">S·∫£n ph·∫©m</a></li>
            <li><a href="../gioThieu/gioithieu.html">Gi·ªõi Thi·ªáu</a></li>
            <li><a href="../lienHe/lienhe.html">Li√™n H·ªá</a></li>
            <li><a href="../gioHang/giohang.html">Gi·ªè h√†ng</a></li>
          </ul>
        </div>
        <div class="footer__contact-item">
          <h3>ƒêƒÇNG K√ù NH·∫¨N TIN</h3>
          <div class="footer__contact-regis">
            <input type="text" id="" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ email" />
            <button class="footer__contact-regis-btn">ƒêƒÉng k√Ω</button>
          </div>
          <div class="footer__contact-icon">
            <a href="">
              <img
                src="https://theme.hstatic.net/200000881795/1001243022/14/facebook.png?v=152"
                alt="Facebook"
            /></a>
            <a href="">
              <img
                src="https://theme.hstatic.net/200000881795/1001243022/14/instagram.png?v=152"
                alt="Instagram"
            /></a>
          </div>
        </div>
      </div>

      <div class="footer__PaymentMethod">
        <a href="#">
          <img
            src="https://theme.hstatic.net/200000881795/1001243022/14/footer_trustbadge.png?v=152"
            alt="Ph∆∞∆°ng th·ª©c thanh to√°n"
          />
        </a>
      </div>
    </footer>

    <!-- JavaScript -->
    <script src="../js/header.js"></script>
    <script src="../gioHang/giohang.js"></script>
    <script src="../asset/bootstap/js/bootstrap.bundle.min.js"></script>
    <script>
      const products = JSON.parse(localStorage.getItem('cartItems')) || [];
      const cartItems = document.getElementById('cartItems');
      const totalAmountElement = document.getElementById('totalAmount');

      let totalAmount = 0;

      products.forEach((product, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
                <td><input type="checkbox" class="select-product" data-index="${index}"></td>
                <td>${product.name}</td>
                <td>${product.price.toLocaleString()} VNƒê</td>
                <td class="quantity-control">
                    <button onclick="updateQuantity(${index}, -1)">-</button>
                    <span>${product.quantity}</span>
                    <button onclick="updateQuantity(${index}, 1)">+</button>
                </td>
                <td>${(
                  product.price * product.quantity
                ).toLocaleString()} VNƒê</td>
                <td><button onclick="removeItem(${index})" style="background-color: red; color: white; border: none; padding: 5px 10px; border-radius: 4px;">X√≥a</button></td>
            `;
        cartItems.appendChild(row);
        totalAmount += product.price * product.quantity;
      });

      totalAmountElement.innerText = totalAmount.toLocaleString();

      function updateQuantity(index, change) {
        products[index].quantity += change;
        if (products[index].quantity < 1) products[index].quantity = 1;
        localStorage.setItem('cartItems', JSON.stringify(products));
        location.reload();
      }
      // X√≥a 1 s·∫£n ph·∫©m
      function removeItem(index) {
        products.splice(index, 1);
        localStorage.setItem('cartItems', JSON.stringify(products));
        location.reload();
      }
      // Thanh to√°n xong th√¨ x√≥a ph·∫ßn t·ª≠ ƒë√≥ ƒëi
      document
        .getElementById('confirmPayment')
        .addEventListener('click', () => {
          const selectedItems = document.querySelectorAll(
            '.select-product:checked'
          );
          if (selectedItems.length === 0) {
            alert('üîî Vui l√≤ng ch·ªçn m·ªôt s·∫£n ph·∫©m ƒë·ªÉ thanh to√°n.');
            return;
          } else {
            if (selectedItems.length === 1) {
              paymentProducts =
                JSON.parse(localStorage.getItem('paymentProducts')) || [];
              selectedItems.forEach((checkbox) => {
                const index = parseInt(checkbox.dataset.index);
                // ƒê∆∞a th√¥ng tin s·∫£n ph·∫©m x√≥a v√†o 1 localStorage ƒë·ªÉ trang thanh to√°n c√≥ th·ªÉ l·∫•y d·ªØ li·ªáu
                if (index >= 0 && index < products.length) {
                  paymentProducts.push({
                    name: products[index].name,
                    price: products[index].price,
                    quantityProduct: products[index].quantity,
                    img: products[index].img,
                  });
                  products.splice(index, 1);
                  localStorage.setItem(
                    'paymentProducts',
                    JSON.stringify(paymentProducts)
                  );
                } else {
                  alert('Kh√¥ng c√≥ s·∫£n ph·∫©m');
                }
              });

              localStorage.setItem('cartItems', JSON.stringify(products));
              alert('‚úÖ ƒê√£ x√°c nh·∫≠n s·∫£n ph·∫©m c·∫ßn thanh to√°n!');
              location.reload();
              window.location.href = '../html/thanhtoan.html';
            } else {
              alert('üîî Vui l√≤ng ch·ªâ ch·ªçn m·ªôt s·∫£n ph·∫©m ƒë·ªÉ thanh to√°n.');
              return;
            }
          }
        });
    </script>
  </body>
</html>
